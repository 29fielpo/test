<!DOCTYPE html>
<html>
<head>
    <title>VR Whack-a-Mole Game</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <!-- UI for score display -->
    <div id="ui">
        <div>Score: <span id="score">0</span></div>
        <div>Time: <span id="timer">60</span></div>
    </div>

    <a-scene background="color: #784A7B" cursor="rayOrigin: mouse">
        <!-- Assets -->
        <a-assets>
            <a-mixin id="mole-animation" 
                     animation__up="property: position; to: 0 1 0; dur: 500; easing: easeOutQuad"
                     animation__down="property: position; to: 0 -0.5 0; dur: 500; easing: easeInQuad; startEvents: hide">
            </a-mixin>
        </a-assets>

        <!-- Camera with cursor for gaze interaction -->
        <a-camera position="0 2 5">
            <a-cursor 
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat"
                animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                animation__fuse="property: scale; startEvents: fusing; from: 1 1 1; to: 1.2 1.2 1.2; dur: 1500"
                raycaster="objects: .mole">
            </a-cursor>
        </a-camera>

        <!-- Ground -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" 
                 color="#E5864B" shadow="receive: true"></a-plane>


        <!-- Ground -->
        <a-plane position="0 5 -5" rotation="0 0 0" width="10" height="10" 
                 src="instructions.png" ></a-plane>
                 
			<!-- Instruction Sheet -->
			<img src="instructions.png" alt="Helpful Image">

        <!-- Holes in the ground (visual indicators) -->
        <a-circle position="-2 0.01 -2" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="0 0.01 -2" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="2 0.01 -2" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="-2 0.01 0" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="0 0.01 0" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="2 0.01 0" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="-2 0.01 2" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="0 0.01 2" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>
        <a-circle position="2 0.01 2" rotation="-90 0 0" radius="0.6" color="#040404"></a-circle>

        <!-- Mole positions (initially hidden) -->
        <a-entity id="mole-container"></a-entity>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="5 10 5" color="#ffffff" 
                 shadow="cast: true; mapSize: 2048 2048"></a-light>

        <!-- Sky -->
        <a-sky color="#784A7B"></a-sky>
        
    </a-scene>
    
    <script>
        // Game variables
        let score = 0;
        let timeLeft = 60;
        let gameActive = true;
        let molePositions = [
            {x: -2, z: -2}, {x: 0, z: -2}, {x: 2, z: -2},
            {x: -2, z: 0}, {x: 0, z: 0}, {x: 2, z: 0},
            {x: -2, z: 2}, {x: 0, z: 2}, {x: 2, z: 2}
        ];
        let activeMoles = [];

        // Wait for A-Frame to load
        document.querySelector('a-scene').addEventListener('loaded', function() {
            startGame();
        });
		
        function startGame() {
            gameActive = true;
            score = 0;
            timeLeft = 60;
            updateUI();
            
            // Start the game timer
            const gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                
                if (timeLeft <= 0) {
                    clearInterval(gameTimer);
                    endGame();
                }
            }, 1000);
            
            // Start spawning moles
            spawnMoleLoop();
        }

        function spawnMoleLoop() {
            if (!gameActive) return;
            
            // Spawn a mole every 1-2 seconds
            setTimeout(() => {
                if (gameActive) {
                    spawnMole();
                    spawnMoleLoop();
                }
            }, Math.random() * 1000 + 100);
        }

        function spawnMole() {
            // Don't spawn if we have too many active moles
            if (activeMoles.length >= 7) return;
            
            // Choose a random position that's not occupied
            const availablePositions = molePositions.filter(pos => 
                !activeMoles.some(mole => mole.position.x === pos.x && mole.position.z === pos.z)
            );
            
            if (availablePositions.length === 0) return;
            
            const position = availablePositions[Math.floor(Math.random() * availablePositions.length)];
            
            // Randomly choose between box and sphere
            const isBox = Math.random() > 0.5;
            const mole = document.createElement('a-entity');
            
            if (isBox) {
                mole.setAttribute('geometry', 'primitive: cone; radius-bottom: 0.4; radius-top: 0.01');
                mole.setAttribute('material', 'color: #FEAE03');
                
            } else {
                mole.setAttribute('geometry', 'primitive: sphere; radius: 0.4');
                mole.setAttribute('material', 'color: #FEAE03');
            }
            
            mole.setAttribute('position', `${position.x} -0.5 ${position.z}`);
            mole.setAttribute('class', 'mole');
            mole.setAttribute('shadow', 'cast: true');
            
            // Add click/gaze interaction
            mole.addEventListener('click', function() {
                hitMole(mole);
            });
            
            // Add to scene and active moles list
            document.querySelector('#mole-container').appendChild(mole);
            activeMoles.push({element: mole, position: position});
            
            // Animate mole popping up
            mole.setAttribute('animation', 'property: position; to: ' + position.x + ' 1 ' + position.z + '; dur: 500; easing: easeOutQuad');
            
            // Hide mole after 2-3 seconds if not hit
            setTimeout(() => {
                if (mole.parentNode) {
                    hideMole(mole);
                }
            }, Math.random() * 1000 + 2000);
        }

        function hitMole(mole) {
            if (!gameActive) return;
            
            score += 10;
            updateUI();
            
            // Visual feedback - make mole flash and disappear
            mole.setAttribute('material', 'opacity: 0');
            setTimeout(() => {
                hideMole(mole);
            }, 200);
        }

        function hideMole(mole) {
            // Remove from active moles list
            activeMoles = activeMoles.filter(m => m.element !== mole);
            
            // Animate mole going down
            const currentPos = mole.getAttribute('position');
            mole.setAttribute('animation', 
                'property: position; to: ' + currentPos.x + ' -0.5 ' + currentPos.z + '; dur: 500; easing: easeInQuad');
            
            // Remove from scene after animation
            setTimeout(() => {
                if (mole.parentNode) {
                    mole.parentNode.removeChild(mole);
                }
            }, 500);
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('timer').textContent = timeLeft;
        }

        function endGame() {
            gameActive = false;
            
            // Clear all active moles
            activeMoles.forEach(mole => {
                if (mole.element.parentNode) {
                    mole.element.parentNode.removeChild(mole.element);
                }
            });
            activeMoles = [];
            
            alert(`Game Over! Final Score: ${score}`);
            
            // Restart game after 2 seconds
            setTimeout(() => {
                startGame();
            }, 2000);
        }
    </script>
</body>
</html>
